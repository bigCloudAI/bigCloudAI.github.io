<!DOCTYPE html>
<html> 
<head>
<meta charset="UTF-8">
<title>走进docker</title>
</head>
<body>
Docker是什么
    Docker，关于它们的新闻从未间断过。Docker1.0在今年6月发布后，声势更是达到了前所未有的程度。
动静之所以这么大，就是因为许多公司在以惊人的速度采用Docker。目前已经有相当数量企业早已将服务器应用程序从虚拟机（VM）转移到容器。与此同时，Docker这项开源技术不仅仅是红帽和Canonical等Linux巨头眼里的宠儿。微软等专有软件公司也在热烈拥抱Docker。
容器使用共享的操作系统。这意味着它们在使用系统资源方面比虚拟机管理程序要高效得多。容器不是对硬件进行虚拟化处理，而是驻留在单单一个Linux实例上。这反过来意味着，你可以“丢弃没有用的99.9%的虚拟机垃圾，剩下一个小巧简洁的胶囊式容器，里面含有你的应用程序，”。借助经过全面调优的容器系统，你就可以在同一硬件上拥有数量比使用Xen虚拟机或KVM虚拟机多出四到六倍的服务器应用实例。
2.Docker特点
Docker带来了之前技术所没有的几个新特点。
第一是，与之前的方法相比，Docker让容器部署和使用起来更容易、更安全。此外，由于Docker与其他容器领域的巨擘进行了合作，包括Canonical、谷歌、红帽和Parallels，共同开发其关键的开源组件libcontainer，它为容器带来了迫切需要的标准化。
第二，广大开发人员可以使用Docker封装、交付和运行任何应用程序，应用程序成为轻型的、可移植的、自给自足的LXC容器，可以在任何地方运行。容器让你立即享有应用程序可移植性。企业组织力求以一种高效、标准化、可重复的方式，让应用程序和工作负载更易于移植和分发，而有时很难做到这点。正如GitHub通过共享源代码来促进合作和创新那样，Docker Hub、Official Repos和商业支持也在帮助众多企业通过改进封装、部署和管理应用程序的方式，应对这个难题
最后但并非最不重要的，Docker容器易于部署到云端。Docker采用了一种特别的方式，以便可以整合到大多数DevOps（开发运营）应用程序当中，包括Puppet、Chef、Vagrant和Ansible，或者可以独自使用，以管理开发环境。主要卖点是，它简化了通常由另外这些应用程序执行的好多任务。具体来说，有了Docker，人们就可以搭建与活动服务器一模一样的本地开发环境，从同一个主机运行多个开发环境（每个开发环境有独特的软件、操作系统和配置），在新的或不同的服务器上测试项目，以及让任何人都可以在设置一模一样的情况下处理同一项目，无论本地主机环境怎样。”
简而言之，Docker能为你做的事情就是：相比其他技术，它能让更多数量的应用程序在同一硬件上运行；它让开发人员易于快速构建可随时运行的容器化应用程序；它大大简化了管理和部署应用程序的任务。总而言之，我能理解作为一项企业级技术，Docker为何一下子蹿红。

3.Docker延伸-生态系统 
从Docker生态系统来看，docker可分为 容器化、服务发现和全局配置存储、网络工具、调度、集群管理和编排这几部分内容。从管理平台功能来看，主要侧重对容器管理、主机管理、编排与调度、服务注册与发现、均衡负载服务、镜像仓库管理的要求。以下从（1）主机管理、容器管理及编排与调度（2）网络工具（3）服务注册与发现（4）均衡负载服务（5）镜像仓库管理 5个方面分析docker及其附属相关工具
1.主机管理、容器管理及编排与调度
完成主机管理、容器管理及编排与调度建立一个集群容器环境时一个必备组件是调度器。

调度器的责任是在相关的宿主机上加载容器、启动容器、停止容器和管理这个进程的生命周期。由于调度器必须要跟组内的每一个宿主机交互，集群管理功能通常也是包括在内的。这就要求调度器获取它们的信息并执行管理任务。在这里，编排通常指的是容器的组合调度和宿主机管理。
一些流行的负责调度和集群管理的工具：
fleet: 调度器和集群管理工具，它从集群中etcd中读取每一个宿主机上的连接信息，然后提供systemd类似的服务管理；
marathon:调度器和集群管理工具，Mesosphere的一个调度和服务管理组件。它配合mesos来控制长时间运行的服务，并为进程和容器管理提供Web界面；
compose:一个用于创建容器组的容器编排工具，通过定义配置文件来提供容器组管理功能。它通过Docker的link来分析容器间的依赖关系；
Swarm:调度器和集群管理工具，旨在提供一个健壮的调度器，采用Docker原生句法使得可以在宿主机上启动容器和进行供应；
mesos:宿主机抽象服务，用于为调度器联合宿主机资源。mesos是一个抽象和管理集群中所有宿主资源的工具。从整个集群到构建在上面的组件，它可以表示一组可用的资源。它描述自己为集群配置的kernel；
kubernetes:一个管理容器组的工具，具有先进的调度能力，Google的高级调度器，kubernetes提供对你的基础设备上的容器更多的控制。容器可以被打标签、分组和配置通信子网。
2.网络工具
应用的容器化倡导面向服务的设计，并提倡将功能点设计为离散的组件，以简化应用的扩展和管理。但是，这也对组件间的网络功能和可靠性提出了更高的要求。Docker自身提供基本的网络结构，包括容器之间和容器与宿主之间的通信结构。
Docker的本地网络能力为容器间的连接提供两种方案。第一种是公开一个容器的端口，并可选择性的映射到宿主机上并为外部路由服务。可以自己决定使用宿主机的端口来映射，也可以让Docker随机的选择一个未使用的高位端口。这是一种在大多数场景中用来提供对容器访问的友好方式。另外一种方法是采用Docker的'links'来允许容器间通信。一个关联的容器将会获得它的对应连接信息，在它处理了那些变量后允许它自动连接。这样就使得同一个宿主机上的容器不需要知道对应服务的端口和地址，就可以直接进行通信。
这个基本的网络环境适用于单宿主机或者严格受限的环境。但是，Docker生态环境已经产生了大量软件，它们重点为运营人员和开发者扩展网络功能。一些额外的网络功能已经通过额外工具实现：（1）覆盖网络来简化和统一多宿主机间的地址空间（2）虚拟私有网络适配来提供多个组件间的安全通信（3）分配子网给每个宿主机或者每个应用（4）建立macvlan接口进行通信（5）为容器配置自己指定的mac地址、网关 等。
参与改进Docker网络功能的项目有：
flannel：覆盖网络提供给每个宿主机一个独立子网，CoreOS团队开发，这个项目被开发的初衷是为每一个宿主系统提供一个共享网络的子网。虽然这是Google kubernetes的一个必要编排工具，但是它在其他场景下也有用处；
weave：覆盖网络描述一个网络上的所有容器，Weave创建一个虚拟网络，使得每个宿主机互联。这简化了应用路由，因为它使得每个容器像被嵌入了一个网络交换机中；
pipework：一个高级网络工具，它用于任意高级网络配置，这个项目使得任意高级网络配置变得容易配置。
tinc：Tinc是一个轻量的VPN软件，它采用隧道和加密实现。Tinc是一个健壮的解决方案，它能够使私有网络对任何应用透明。
3.服务注册与发现
服务发现是整个策略中的一个组成部分，它旨在使容器部署更具有伸缩性和灵活性。使用了服务发现后，可以让容器在没有管理员干预的情况下了解运行环境。它们可以自行发现必须要交互的组件的连接信息，可以自行注册自身以便其它工具知道该组件已准备就绪。这些工具同样经常用作全局分布式配置存储服务，可以存储你基础设施中任意的服务配置信息。

从上图中，你可以看到一个流程，图中应用A注册自身的连接信息给发现服务系统。一旦注册成功，其它应用可以通过查询发现服务系统来找到如何连接这个应用。
这类工具通常这样实现：在分布式环境中用基本的键值对来分布存储。通常来说，键值对存储提供一个HTTP API接口用来存储和获取值。有一些还提供了更加安全的机制，如加密条目或者访问控制机制。除了它们提供新容器自配置的主要功能外，这些分布式存储对管理Docker宿主机也是非常重要的
服务发现存储的一些职责：
（1）允许应用连接它们所依赖的服务以获取所需数据
（2）允许服务为了上述的需求去注册它们的连接信息
（3）提供一个全局可访问的位置，用于存储任意的配置数据
（4）存储任何一个集群管理软件所需要的集群节点信息
一些流行的服务发现工具和相关项目：
etcd：服务发现/全局分布式键值对存储，面向容器和宿主机提供服务发现和全局配置存储功能。它在每个宿主机上有基于http协议的API和命令行的客户端；
consul：服务发现/全局分布式键值对存储，这个服务发现平台有很多高级的特性，使得它脱颖而出，例如：配置健康检查、ACL功能、HAProxy配置等等；
zookeeper：服务发现/全局分布式键值对存储，这个工具较上面两个都比较老，提供一个更加成熟的平台和一些新特性；
crypt：加密etcd条目的项目。允许组件通过采用公钥加密的方式来保护它们的信息。需要读取数据的组件会被分配密钥，而其他组件则不能读取数据；
confd：观测键值对存储变更和新值的触发器重新配置服务，Confd项目旨在基于服务发现的变化，而动态重新配置任意应用程序。该系统包含了一个工具来监测节点中的变化、一个模板系统来根据获取到的值来生成配置文件，并能够重新加载受影响的应用。
4.均衡负载服务
在服务注册与发现的基础上，另一个关键点就是动态重新配置。普通服务发现工具允许用户通过检查在启动时的信息来影响组件的初始配置，而动态重新配置涉及配置组件来反映配置存储中的新信息。例如，当你在运行一个负载均衡，后端服务器上的健康检查可能会提示集群中的某一个成员出现故障了。运行中的成员机器需要知道这个信息，并调整配置信息和重新加载它的负载。负载均衡内容包含
（1）提供基于HAProxy的负载均衡服务（2）定义负载均衡会话保持策略（3）支持高级访问路由功能，支持TCP/UDP/HTTP协议的路由转发（4）平台提供与外部负载均衡设备对接能力
一些流行的服务发现工具和相关项目：
consul：服务发现/全局分布式键值对存储，这个服务发现平台有很多高级的特性，使得它脱颖而出，例如：配置健康检查、ACL功能、HAProxy配置等等；
vulcand：Vulcand在组件中作为负载均衡使用。它使用etcd作为后端，并基于监测变更来调整它的配置；
marathon：虽然marathon主要是调度器，它也实现了一个基本的重新加载HAProxy的功能，当发现变更时它来协调可用的服务；
frontrunner：这个项目嵌入在marathon中对HAProxy的更新提供一个更稳定的解决方案；
synapse：这个项目引入了嵌入式的HAProxy组件，它能够发送流量给各个组件；
nerve：它被用来与synapse结合在一起来为各个组件提供健康检查，如果组件不可用，nerve将更新synapse并将该组件移除出去。
5.镜像仓库管理
官方的Docker hub是一个用于管理公共镜像的好地方，我们可以在上面找到我们想要的镜像，也可以把我们自己的镜像推送上去。但是，有时候，我们的使用场景需要我们拥有一个私有的镜像仓库用于管理我们自己的镜像。这个可以通过开源软件Registry来达成目的。
 Registry在github上有两份代码：老代码库和新代码库。老代码是采用python编写的，存在pull和push的性能问题，出到0.9.1版本之后就标志为deprecated，不再继续开发。从2.0版本开始就到在新代码库进行开发，新代码库是采用go语言编写，修改了镜像id的生成算法、registry上镜像的保存结构，大大优化了pull和push镜像的效率。
 官方在Docker hub上提供了registry的镜像（详情），我们可以直接使用该registry镜像来构建一个容器，搭建我们自己的私有仓库服务。Tag为latest的registry镜像是0.9.1版本的，我们直接采用2.1.1版本。
工具：registry的镜像
</body>
</html>